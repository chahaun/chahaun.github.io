---
layout: post
title:  "Node.js 기본 정리 6"
subtitle:   "Node.js 기본 정리 6"
categories: study
tags: node nodejs express
---

Node.js에 대한 문법 및 내용 기본정리 6으로, 익스프레스 구조를 알아본다.

# Node.js

## 익스프레스 웹 서버 만들기

### Express

npm에는 서버 제작 시 불편함을 해소하고, 편의 기능을 추가한 웹 서버 프레임워크가 있다.  
익스프레스는 http모듈의 요청과 응답 객체에 추가 기능들을 부여했다.  
기존 메서드들도 계속 사용하면서 편리한 메서드들을 추가하여 기능을 보완하였다.  
또한 코드를 분리하기 쉽게 만들어 유지보수에도 용이하고, if문으로 구별하지 않아도 된다.  

익스프레스를 Express-generator로 npm전역설치를 해준다.  
기본적으로 PUG(Jade)를 템플릿 엔진으로 설치한다. EJS를 사용할 수도 있다.  
`express 프로젝트명 --view=pug` 명령으로 프로젝트를 생성해 준다.  
생성한 폴더에서 npm i로 npm모듈들을 설치해주면 서버관련 폴더를 초기화해준다.  

app.js파일은 핵심적인 서버역할을 해주고, bin/www파일은 서버실행 스크립트이다.  
public폴더는 외부에서 접근 가능한 파일들을 모아둔 곳이며, img, css, js파일 등이 있다.  
routes폴더는 주소별 라우터들을 모아둔 곳이고, views 폴더는 템플릿 파일이 있다.  
앞으로 서버의 로직은 모두 routes 폴더에 작성하고, 화면은 views에 작성한다.  
DB부분은 models 부분에 작성하며, 이는 MVC 패턴과 비슷한 구조이다.  
익스프레스의 실행은 npm start로 실행할 수 있으며 지정한 포트번호로 접속해본다.  

### Express의 구조

익스프레스는 코드가 여러개의 파일로 분산되어 있고, 각자 역할이 나누어져있다.  
bin/www파일은 http모듈에 express모듈을 연결하고, 포트를 지정하는 부분이다.  
이 파일은 확장자가 없고, 매직넘버(#!)로 시작하는 파일이다.  
app, debug, http 모듈을 사용하여 구성되어있고, app.js 모듈을 보면 수많은  
use 메서드가 사용된다. 이들은 여러 미들웨어를 구성해주는데, 미들웨어는 요청과  
응답의 중간에 위치하여 요청과 응답을 조작하여 기능을 추가하는 등의 역할을 한다.  

app.js의 미들웨어는 요청이 들어오면 logger('dev')부터 시작하여 json, cookieParser,  
라우터, 404처리, 에러 핸들러를 거쳐서 응답을 진행한다.  
이때 미들웨어 안에서는 next()를 호출해야 다음 미들웨어로 넘어간다.  
app.js에 app.use()를 이용하여 커스텀 미들웨어도 만들어 볼 수 있다.  

next() 함수에 인자를 넣을 때 route를 넣으면 특수한 기능을 한다.  
그 외 다른 값을 넣으면 바로 에러 핸들러로 이동한다. 넣어준 값을 에러내용으로 보는것이다.  
404 에러가 나면 createError(404)를 next의 인자로 넣어 에러핸들러에서 처리를 시작한다.  
받은 인자는 err매개변수에 연결되며 에러를 받아 처리해준다.  
하나의 app.use에는 여러 미들웨어(function)을 장착할 수 있으며, 순서대로 실행된다.  

